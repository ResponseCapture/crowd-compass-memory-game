/*!
 * crowd-compass-memory-game v1.0.0 (https://github.com/ResponseCapture/crowd-compass-memory-game#readme)
 * Copyright 2015 
 * Licensed under the ISC
 */
function shuffle(array){for(var t,i,m=array.length;m;)i=Math.floor(Math.random()*m--),t=array[m],array[m]=array[i],array[i]=t;return array}function Game(cards,timeout,interval){var timer,begin,timer,limit=45,limitMs=1e3*limit,game={};game.deck=shuffle(cards.concat(cards)).map(function(picture){return{item:picture,isFaceUp:!1}});var start=function(){return begin=new Date,mprogress.start(),interval(function(){var elapsed=game.elapsedMs()/1e3;game.isCritical=5>=elapsed,mprogress.set((game.remaining()||0)/limitMs),elapsed>=limit&&stop()},50)},stop=function(){var end=new Date-begin;interval.cancel(timer);var faceDown=game.deck.filter(function(c){return!c.isFaceUp}).length;timeout(function(){game.results={time:Math.ceil(end/1e3),total:game.deck.length/2,missing:Math.ceil(faceDown/2)},mprogress.end()},1500)};game.elapsedMs=function(){return new Date-begin},game.remaining=function(){return begin&&game.elapsedMs()<limitMs?limitMs-game.elapsedMs():void 0};var checkNext;return game.check=function(card){timer||(timer=start()),checkNext?checkNext(card):(card.isFaceUp=!0,checkNext=function(nextCard){nextCard.isFaceUp=!0,nextCard.item===card.item?checkNext=void 0:timeout(function(){nextCard.isFaceUp=card.isFaceUp=!1,checkNext=void 0},250),game.deck.every(function(c){return c.isFaceUp})&&stop()})},game}var mprogress=new Mprogress({parent:"#progress",trickle:!1,minimum:0}),level1=["L1-placer","L1-clock","L1-personality","L1-frazzled","L1-supplies","L1-phones"],app=angular.module("cards",[]);app.controller("CardController",function($scope,$timeout,$interval){$scope.newGame=function(){$scope.game=Game(level1,$timeout,$interval)}});